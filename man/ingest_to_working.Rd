% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ducklake.R
\name{ingest_to_working}
\alias{ingest_to_working}
\title{Ingest data to Working DuckLake}
\usage{
ingest_to_working(
  con,
  data,
  table,
  source_file,
  source_uuid_col = NULL,
  source_row_start = 1,
  mode = "append",
  upsert_keys = NULL
)
}
\arguments{
\item{con}{DuckDB connection from \code{get_working_ducklake()}}

\item{data}{Data frame to ingest}

\item{table}{Target table name}

\item{source_file}{Path to original CSV file in Archive (for provenance).
Should be the full path including archive timestamp
(e.g., "archive/2026-02-02_121557/swfsc.noaa.gov/calcofi-db/larva.csv")}

\item{source_uuid_col}{Column name containing original UUIDs (optional).
If provided, values are stored in \code{_source_uuid} for tracing back
to source records.}

\item{source_row_start}{Starting row number in source file (default: 1)}

\item{mode}{Insert mode: "append", "replace", or "upsert" (default: "append")
\itemize{
\item \code{append}: Add rows to existing table
\item \code{replace}: Drop and recreate table
\item \code{upsert}: Update existing rows, insert new rows (requires \code{upsert_keys})
}}

\item{upsert_keys}{Character vector of column names to use as keys for upsert mode}
}
\value{
Tibble with ingestion statistics:
\itemize{
\item \code{table}: Table name
\item \code{mode}: Insert mode used
\item \code{rows_input}: Number of rows in input data
\item \code{rows_after}: Number of rows in table after ingestion
\item \code{ingested_at}: Timestamp of ingestion
}
}
\description{
Ingests a data frame into the Working DuckLake with automatic provenance tracking.
Adds \code{_source_file}, \code{_source_row}, \code{_source_uuid}, and
\code{_ingested_at} columns to track data lineage.
}
\examples{
\dontrun{
con <- get_working_ducklake()

larvae_data <- readr::read_csv("larvae.csv")
stats <- ingest_to_working(
  con         = con,
  data        = larvae_data,
  table       = "larva",
  source_file = "archive/2026-02-02_121557/swfsc.noaa.gov/calcofi-db/larva.csv",
  source_uuid_col = "larva_uuid",
  mode        = "replace")

# append new data
new_data <- readr::read_csv("larvae_update.csv")
stats <- ingest_to_working(
  con         = con,
  data        = new_data,
  table       = "larva",
  source_file = "archive/2026-03-01_121557/swfsc.noaa.gov/calcofi-db/larva.csv",
  mode        = "append")
}
}
\concept{ducklake}
