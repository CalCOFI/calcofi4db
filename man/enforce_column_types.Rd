% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/wrangle.R
\name{enforce_column_types}
\alias{enforce_column_types}
\title{Enforce Column Types Before Export}
\usage{
enforce_column_types(
  con,
  d_flds_rd = NULL,
  type_overrides = NULL,
  tables = NULL,
  verbose = TRUE
)
}
\arguments{
\item{con}{DuckDB connection}

\item{d_flds_rd}{Field redefinition data frame with columns \code{tbl_new},
\code{fld_new}, \code{type_new} (optional; NULL skips this source)}

\item{type_overrides}{Named list of \code{table.column = "SQL_TYPE"} overrides
for derived-table columns (optional; NULL skips)}

\item{tables}{Character vector of tables to enforce. If NULL, uses all
tables from \code{DBI::dbListTables(con)}.}

\item{verbose}{Print messages for each change (default: TRUE)}
}
\value{
Tibble of changes applied (table, column, from_type, to_type, success)
}
\description{
Runs \verb{ALTER TABLE ... ALTER COLUMN ... TYPE} for every column whose current
DuckDB type differs from the target type. Intended to run right before
\code{write_parquet_outputs()} so that parquet files carry correct integer/decimal
types instead of DOUBLE from R's default numeric mapping.
}
\details{
Target types come from two sources:
\enumerate{
\item \code{d_flds_rd} (field redefinition data frame) — keyed by \code{tbl_new.fld_new}
with target in \code{type_new}
\item \code{type_overrides} — named list for derived-table columns not in the
redefinition file, e.g. \code{list(ichthyo.species_id = "SMALLINT")}
}
}
\examples{
\dontrun{
changes <- enforce_column_types(
  con            = con,
  d_flds_rd      = d$d_flds_rd,
  type_overrides = list(
    ichthyo.species_id = "SMALLINT",
    ichthyo.tally      = "INTEGER"),
  verbose        = TRUE)
}
}
\concept{wrangle}
