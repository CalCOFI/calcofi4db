% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/check.R
\name{check_data_integrity}
\alias{check_data_integrity}
\title{Check Data Integrity for Ingestion}
\usage{
check_data_integrity(
  d,
  dataset_name = "Dataset",
  halt_on_fail = TRUE,
  type_exceptions = NULL,
  display_format = "DT",
  verbose = TRUE,
  header_level = 3
)
}
\arguments{
\item{d}{List output from read_csv_files() containing CSV and redefinition data}

\item{dataset_name}{Name of dataset for display purposes (e.g., "NOAA CalCOFI Database")}

\item{halt_on_fail}{Logical, whether to set knitr eval=FALSE on failure (default: TRUE)}

\item{type_exceptions}{Character vector of known acceptable type mismatches.
Use \code{"all"} to accept all type mismatches, or specific \code{"table.field"}
patterns (e.g., \code{c("casts.time", "bottle.t_qual")}). Default: NULL (no exceptions).}

\item{display_format}{Format for displaying changes: "DT" (DataTable), "kable", or "print" (default: "DT")}

\item{verbose}{Logical, print detailed messages (default: TRUE)}

\item{header_level}{Integer, markdown header level for output messages (default: 3).
Controls the top-level header depth; sub-headers use header_level + 1.
Set to match the parent section level in your Quarto document to keep
the Table of Contents hierarchy correct.}
}
\value{
List with:
\itemize{
\item passed: Logical indicating if integrity check passed
\item changes: Full changes object from detect_csv_changes()
\item n_changes: Number of changes detected (after filtering exceptions)
\item n_exceptions: Number of type mismatches accepted as exceptions
\item message: Character string with markdown-formatted message
}
}
\description{
Validates that CSV files match their redefinition metadata before database
ingestion. This function is designed to be called from Quarto notebooks and
will stop notebook execution if mismatches are detected.
}
\details{
The function:
\enumerate{
\item Detects changes between CSV files and redefinitions using detect_csv_changes()
\item Optionally filters out known acceptable type mismatches via \code{type_exceptions}
\item Prints summary statistics of detected changes
\item Displays interactive table of changes if any exist
\item Returns appropriate status for notebook control flow
}

When called from a Quarto notebook in an output: asis chunk, this function
will render markdown messages and can control chunk evaluation via knitr options.
}
\examples{
\dontrun{
# strict check â€” halt on any mismatch
integrity <- check_data_integrity(d, "NOAA CalCOFI Database")

# accept all type mismatches (e.g., readr infers types differently)
integrity <- check_data_integrity(
  d               = d,
  dataset_name    = "CalCOFI Bottle Database",
  halt_on_fail    = FALSE,
  type_exceptions = "all")

# use header_level = 2 for top-level sections
integrity <- check_data_integrity(
  d            = d,
  dataset_name = "NOAA CalCOFI Database",
  header_level = 2)
}
}
\concept{check}
