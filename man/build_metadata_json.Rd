% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/wrangle.R
\name{build_metadata_json}
\alias{build_metadata_json}
\title{Build Metadata JSON for Parquet Outputs}
\usage{
build_metadata_json(
  con,
  d_tbls_rd,
  d_flds_rd,
  metadata_derived_csv = NULL,
  output_dir,
  tables = NULL,
  set_comments = TRUE,
  provider = NULL,
  dataset = NULL,
  workflow_url = NULL
)
}
\arguments{
\item{con}{DuckDB connection}

\item{d_tbls_rd}{Table redefinition data frame (with \code{tbl_new}, \code{tbl_description})}

\item{d_flds_rd}{Field redefinition data frame (with \code{tbl_new}, \code{fld_new},
\code{fld_description}, \code{units})}

\item{metadata_derived_csv}{Path to CSV with derived table/column metadata
(columns: table, column, name_long, units, description_md)}

\item{output_dir}{Directory to write \code{metadata.json}}

\item{tables}{Character vector of table names to include. If NULL, uses all
tables from DuckDB.}

\item{set_comments}{If TRUE, also sets DuckDB \verb{COMMENT ON} for tables/columns}

\item{provider}{Data provider identifier (e.g. "swfsc.noaa.gov")}

\item{dataset}{Dataset identifier (e.g. "calcofi-db")}

\item{workflow_url}{URL to the rendered workflow page}
}
\value{
Path to the created \code{metadata.json} file
}
\description{
Creates a sidecar \code{metadata.json} file alongside parquet outputs that
documents every table and column. DuckDB \verb{COMMENT ON} does not propagate
to parquet via \verb{COPY TO}, so this provides the metadata externally.
}
\details{
Metadata is assembled from three sources:
\enumerate{
\item Table/field redefinition files (\code{d_tbls_rd}, \code{d_flds_rd})
\item A derived metadata CSV for workflow-created tables/columns
\item Auto-generated stubs for any remaining undocumented columns
}

Optionally sets DuckDB \verb{COMMENT ON} for tables and columns.
}
\examples{
\dontrun{
build_metadata_json(
  con                  = con,
  d_tbls_rd            = d$d_tbls_rd,
  d_flds_rd            = d$d_flds_rd,
  metadata_derived_csv = "metadata/swfsc.noaa.gov/calcofi-db/metadata_derived.csv",
  output_dir           = "data/parquet/swfsc.noaa.gov_calcofi-db",
  tables               = DBI::dbListTables(con),
  provider             = "swfsc.noaa.gov",
  dataset              = "calcofi-db",
  workflow_url         = "https://calcofi.io/workflows/ingest_swfsc.noaa.gov_calcofi-db.html")
}
}
\concept{wrangle}
